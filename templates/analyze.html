<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../static/js/jquery-3.5.1.min.js"></script>
    <title>Books List</title>
    <link rel="stylesheet" href="../static/css/libr_frontpage.css">
    <style>

    /* 选择框容器样式 */
    .select-container {
        text-align: center; /* 使容器内的内容居中 */
        margin-bottom: 20px; /* 选择框与表格之间的间距 */
        display: flex; /* 使用 flexbox 布局 */
        justify-content: center; /* 在水平方向上居中 */
        align-items: center; /* 在垂直方向上居中 */
    }

    /* 选择框标题样式 */
    .select-container strong {
        margin-right: 10px; /* 给标题添加右边距 */
        font-size: 1.2rem; /* 设置标题的字体大小 */
        color: #333; /* 设置标题颜色 */
    }

    /* 选择框样式 */
    #statsOption {
        padding: 8px 12px; /* 增加选择框的内边距 */
        font-size: 1rem; /* 设置选择框文字的大小 */
        border-radius: 5px; /* 圆角效果 */
        border: 1px solid #ddd; /* 设置边框颜色 */
        outline: none; /* 去掉点击时的轮廓 */
    }

    #statsOption:hover {
        border-color: #7fb254; /* 鼠标悬停时改变边框颜色 */
    }

    #statsOption:focus {
        border-color: #7fb254; /* 获取焦点时改变边框颜色 */
        box-shadow: 0 0 5px rgba(127, 178, 84, 0.6); /* 获取焦点时添加阴影 */
    }

    </style>
</head>
<body>
        <div class="nav">
        <div class="nav-wrapper">
            <div class="nav-item">
                <a href="#" class="alink">
                    <span>Resources</span>
                    <img src="../static/img/drop.png" alt="">
                </a>
                <div class="nav-drop-down-wrapper">
                    <div class="nav-drop-down">
                        <div class="down-item">
                            <div class="down-item-wrapper">
                                <span>Books 📕</span>
                            </div>
                        </div>
                        <div class="down-item">
                            <div class="down-item-wrapper">
                                <span>E-resources</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="nav-item">
                <a href="#" class="alink">
                    <span>Manage</span>
                    <img src="../static/img/drop.png" alt="">
                </a>
                <div class="nav-drop-down-wrapper">
                    <div class="nav-drop-down">
                        <div class="down-item">
                            <div class="down-item-wrapper">
                                <span>Users 👩‍💻</span>
                            </div>
                        </div>
                        <div class="down-item">
                            <div class="down-item-wrapper">
                                <span>Books 📚</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="nav-item">
                <a href="#" class="alink">
                    <span>Data</span>
                    <img src="../static/img/drop.png" alt="">
                </a>
                <div class="nav-drop-down-wrapper">
                    <div class="nav-drop-down">
                        <div class="down-item">
                            <div class="down-item-wrapper">
                                <span>Borrowing Status 📊</span>
                            </div>
                        </div>
                    </div>
                    <div class="nav-drop-down">
                        <div class="down-item">
                            <div class="down-item-wrapper">
                                <span>Analyze 🍉</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="nav-item">
                <a href="#" class="alink">
                    <span>Account</span>
                    <img src="../static/img/drop.png" alt="">
                </a>
                <div class="nav-drop-down-wrapper">
                    <div class="nav-drop-down">
                        <div class="down-item">
                            <div class="down-item-wrapper">
                                <span>Personal Center 🩷</span>
                            </div>
                        </div>
                        <div class="down-item">
                            <div class="down-item-wrapper">
                                <span>Log out</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        $('.down-item-wrapper').click(function() {
            var itemText = $(this).text().trim(); // 获取点击项的文本内容
            if (itemText === 'Books 📕') {
                // 如果点击的是 "Books 📕"
                window.location.href = '/books'; // 跳转到 books 页面
            }
            else if (itemText === 'E-resources') {
                // 如果点击的是 "E-resources"
                window.location.href = '/e_resources'; // 跳转到 e-resources 页面
            }
            else if (itemText === 'Users 👩‍💻') {
                window.location.href = '/users'; // 跳转到 e-resources 页面
            }
            else if (itemText === 'Books 📚') {
                window.location.href = '/books_manage'; // 跳转到 e-resources 页面
            }
            else if (itemText === 'Personal Center 🩷') {
                window.location.href = '/personal_center'; // 跳转到 e-resources 页面
            }
            else if (itemText === 'Borrowing Status 📊') {
                window.location.href = '/borrowing_status'; // 跳转到 e-resources 页面
            }
            else if (itemText === 'Analyze 🍉') {
                window.location.href = '/analyze'; // 跳转到 e-resources 页面
            }
            else if (itemText === 'Log out') {
                window.location.href = '/';
            }
        });
    </script>

    <!-- 显示统计结果的表格 -->
    <div class="table-container">
        <h1 style="text-align: center;">( *｀ω´) Borrowing Analyze (´ω｀*)</h1>
        <!-- 选择统计的维度 -->
        <div class="select-container">
            <strong>Choose a Statistic:</strong>
            <select id="statsOption" onchange="showStatistic()">
                <option value="genre">Genre</option>
                <option value="author">Author</option>
                <option value="publication_year">Publication Year</option>
            </select>
        </div>

        <table id="statsTable">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Borrow Count</th>
                </tr>
            </thead>
            <tbody id="recordTable">
                <!-- 默认显示 Genre 数据 -->
                {% for record in genrecords %}
                    <tr>
                        <td>{{ record.category }}</td>
                        <td>{{ record.borrow_count }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>


    <script>
        // 页面加载时默认显示 Genre
        window.onload = function() {
            showStatistic();  // 页面加载后自动调用 showStatistic() 函数
        };

        function showStatistic() {
            const selectedOption = document.getElementById("statsOption").value;

            // 获取后端传递的JSON数据
            const genRecords = {{ genrecords | tojson }};  // 使用 Jinja2 的 tojson 来将数据转换为 JSON 格式
            const autRecords = {{ autrecords | tojson }};
            const pubRecords = {{ pubrecords | tojson }};

            let recordsToDisplay = [];
            if (selectedOption === "genre") {
                recordsToDisplay = genRecords;
            } else if (selectedOption === "author") {
                recordsToDisplay = autRecords;
            } else if (selectedOption === "publication_year") {
                recordsToDisplay = pubRecords;
            }

            // 清空表格内容
            const tableBody = document.querySelector("#statsTable tbody");
            tableBody.innerHTML = "";

            // 填充新选项对应的数据
            recordsToDisplay.forEach(record => {
                const tr = document.createElement("tr");
                const tdCategory = document.createElement("td");
                tdCategory.textContent = record.category; // category字段
                const tdCount = document.createElement("td");
                tdCount.textContent = record.borrow_count; // borrow_count字段
                tr.appendChild(tdCategory);
                tr.appendChild(tdCount);
                tableBody.appendChild(tr);
            });
        }
    </script>



</body>
</html>
